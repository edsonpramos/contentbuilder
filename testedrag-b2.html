<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>FCAV ContentBuilder</title>

  <link rel="stylesheet" href="http://code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/contentbuilder.css" rel="stylesheet">
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="http://code.jquery.com/ui/1.11.2/jquery-ui.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/bootstrap-collapse.js"></script>
  <script src="js/bootstrap-tab.js"></script>
  <script>
  $(function() {
    $( "#miolo" ).sortable({
	  placeholder: "ui-state-highlight",
	  items: ".bloco",
	  cursorAt: { top: 0 },
	  receive:function(event,ui){
        var template_name = ui.helper.data("template");
        var template_content = setTemplateContent(template_name);
		
        var block_name = 'bloco-'+template_name;
		var block = $('<div class="bloco '+block_name+' ui-sortable-handle"></div>');
			block.html(template_content);
		
        ui.helper.after(block);
		ui.helper.remove();
	  },
	  change:function(event,ui){
		$('.ui-sortable-helper').appendTo('#templates');
	  },
    });
	
	$("#miolo, #templates").disableSelection();
    
	$( ".template" ).draggable({
      helper: "clone",
	  cursor:"crosshair",
	  cursorAt: { top: 0 },
      opacity:.7,
	  connectToSortable: "#miolo",
    }); 

	/*var aba1 = new tagTool();
	var aba2 = new tagTool();
	aba1.init();
	console.log(aba1.getCounter());
	aba2.init();
	console.log(aba2.getCounter());*/
	
	$('.bloco-accordion').on({
		mouseover:function(){
			var accordion = $(this).children('.accordion').eq(0);//pega o accordion;
			
		},
	});
  });
  
  var getUid = (function() {
	  function s4() {
		return Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);
	  }
	  return function() {
		return s4() + s4() + '-' + s4() + '-' + s4() + '-' +
			   s4() + '-' + s4() + s4() + s4();
	  };
	})();
  
  function setTemplateContent(template_name){
    var capitalized_template_name = template_name.substr(0,1).toUpperCase() + template_name.substr(1,template_name.length-1);
	return eval('set'+capitalized_template_name+'Content()');
  }
  
  function setAccordionContent(){
    var template = $('#template_accordion');// js template
    var template_id = getUid();
    var template_content = $(template.html().toString().replace(/(\{\{id\}\})/g,template_id));
        template_content.append(getAccordionChild(template_id));
        //call template add button
        template_content.click(function(e){
            var tool = $('body').find('.tool').eq(0);
            tool.css({
                'display':'block',
                'top':$(this).position().top+'px',
                'left':($(this).position().left-10)+'px',
            });
        });
    setAction('add',template_id,'accordion');    
    return template_content;
  }
  
  function getAccordionChild(template_id){
    var template_child = $('#template_accordion-child');
    var template_child_id = getUid();
    var template_child_content = template_child.html().toString().replace(/(\{\{id\}\})/g,template_id);
        template_child_content = template_child_content.replace(/(\{\{childId\}\})/g,template_child_id);
        template_child_content = $(template_child_content);
    setAction('delete',template_child_id);    
    return template_child_content;
  }
  
  
  function setAction(bindId, targetId, template_name){
    switch(bindId){
        case "add":
            if($('body').find('.bt_add').size() == 0){
                var tool = $('#tool').html().toString().replace(/(\{\{target\}\})/g, template_name + '_' + targetId);
                $('body').append($(tool));
            }else{
                $('body').find('.tool').eq(0).data('target',template_name + '_' + targetId);
            }
            //set add button
            $('body').find('.bt_add').eq(0).click(function(e){
                var target = $('#'+$(this).parent().data('target'));
                var template_name = $(this).parent().data('target').split('_')[0];
                var template_id = $(this).parent().data('target').split('_')[1];
                var capitalized_template_name = template_name.substr(0,1).toUpperCase() + template_name.substr(1,template_name.length-1);
                target.append(eval('get'+capitalized_template_name+'Child("' + template_id + '")'));
            });
            
            //set cancel button
            $('body').find('.bt_cancel').click(function(e){
                $(this).parent().hide();
            });
            break;

        case "delete":
            break;
    }
  }
  
  
  var accordion = {
    init:function(){},
    openModal:function(){},
    getContent:function(){},
    getTemplate:function(){},
    mergeCode:function(){},
    defineTools:function(){},
    createBlock:function(){},
    appendAll:function(){},
  }
  
  /*function tagTool(){
	var counter = 15;//private
	tagTool.counter = 0;//static
	this.init = function(){//public
		tagTool.counter++;
	}
	this.getCounter = function(){//public
		return counter +','+ tagTool.counter;
	}
  }*/
  
  </script>
  
  <script id="tpt-00" type="text/template">
	<h3>Vai meu filho</h3>
	<p>Aliquam dui neque, dignissim sit amet aliquet at, tincidunt id nisi. Etiam vehicula, turpis eu hendrerit pretium, justo erat sagittis tortor, a tincidunt magna metus et mi. Ut id accumsan magna. Fusce eu eros vel mauris auctor imperdiet non in tellus. Vivamus nulla ante, aliquet et tempus sed, convallis a arcu. Cras id sem mi. Praesent sed sapien neque, ut consectetur mi.</p>
  </script>
  
  <script id="tpt-01" type="text/template">
	<table class="table">
	  <caption>Caption</caption>
	  <thead>
		<tr>
		  <th>TH</th>
		  <th>TH</th>
		</tr>
	  </thead>
	  <tbody>
		<tr>
		  <td>TD</td>
		  <td>TD</td>
		 </tr>
	  </tbody>
	</table>
  </script>
  
  <script id="tpt-02" type="text/template">
	<p>
		<img class="img-responsive pull-right span8" src="img/imagem.png">
		Pellentesque volutpat interdum ultricies. Aenean nibh eros, fermentum at sollicitudin sit amet, eleifend ac eros. Vestibulum ut diam arcu. Morbi feugiat fermentum dolor a convallis. Aenean mattis rhoncus lectus non porta. Duis in nisi nec nisi pulvinar iaculis. Aliquam accumsan nibh et sem condimentum vel scelerisque diam volutpat. Praesent vel risus enim, sed auctor libero. Duis nec mi massa, sed convallis diam. Integer venenatis porttitor facilisis. Nam aliquet odio quis sapien eleifend sollicitudin in a orci. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Duis urna metus, posuere at mattis in, rutrum sagittis massa. Vestibulum ac purus dui, sed tempor justo. Sed ultricies consectetur nibh sed mattis.
	</p>
  </script>
  
  <script id="tpt-14" data-type="tab" type="text/template">
	<ul class="nav nav-tabs">
	  <li class="active"><a href="#home" data-toggle="tab">Home</a></li>
	  <li><a href="#profile" data-toggle="tab">Profile</a></li>
	  <li><a href="#messages" data-toggle="tab">Messages</a></li>
	  <li><a href="#settings" data-toggle="tab">Settings</a></li>
	</ul>
	 
	<div class="tab-content">
	  <div class="tab-pane active" id="home">...</div>
	  <div class="tab-pane" id="profile">...</div>
	  <div class="tab-pane" id="messages">...</div>
	  <div class="tab-pane" id="settings">...</div>
	</div>
  </script>
  
  <script id="template_accordion" type="text/template">
    <div class="accordion" id="accordion_{{id}}"></div>
  </script>
  
  <script id="template_accordion-child" type="text/template">
	<div class="accordion-group" >
		<div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_{{id}}" href="#collapse_{{childId}}">Insira um t√≠tulo aqui.</a>
		</div>
		<div id="collapse_{{childId}}" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="bloco"><p>Insira um texto aqui.</p></div>
            </div>
		</div>
    </div>
  </script>
  
  <script id="tool" type="text/template">
	<ul class="tool" data-target="{{target}}">
		<li class="bt_add">+</li>
		<li class="bt_delete">-</li>
        <li class="bt_cancel">x</li>
	</ul>
  </script>
</head>
<body>
<a href="#miolo" class="sr-only sr-only-focusable">Skip to main content</a>
	<div id="miolo">
		<div class="bloco"><p>Aliquam dui neque, dignissim sit amet aliquet at, tincidunt id nisi. Etiam vehicula, turpis eu hendrerit pretium, justo erat sagittis tortor, a tincidunt magna metus et mi. Ut id accumsan magna. Fusce eu eros vel mauris auctor imperdiet non in tellus. Vivamus nulla ante, aliquet et tempus sed, convallis a arcu. Cras id sem mi. Praesent sed sapien neque, ut consectetur mi.</p></div>
		<div class="bloco"><p>Aenean nec tellus nec neque feugiat volutpat eu sit amet elit. Proin mattis pulvinar ante, a fringilla urna placerat a. Praesent magna nunc, pharetra in venenatis et, faucibus consequat nulla. Nunc sit amet mi sit amet urna lobortis facilisis quis id risus. Morbi vestibulum, ipsum scelerisque pellentesque hendrerit, eros nunc bibendum eros, vel lacinia turpis turpis ut orci. Praesent faucibus urna eu enim egestas et imperdiet odio semper. Etiam aliquet lorem nec ligula feugiat commodo. Proin pulvinar aliquet turpis, vitae pharetra nisl ornare sed. Morbi aliquam sapien vulputate quam vulputate sodales. Vivamus vitae libero ligula, ac cursus sapien.</p></div>
		<div class="bloco"><p>Integer mattis volutpat condimentum. Vivamus pharetra, quam et auctor tempor, leo mi placerat magna, ut dapibus dui dui convallis mi. Vestibulum semper elit quis tellus ultrices ac cursus erat volutpat. Suspendisse sem erat, semper sed fringilla id, bibendum at risus. Morbi justo ligula, egestas vel feugiat a, luctus at eros. </p></div>
	</div>
	<div id="templates">
	  <div class="scroll">
		<div class="template" data-template="text"><img src="img/templates/text.png"/></div>
	
		<div class="template" data-template="textpict-left"><img src="img/templates/textpict-left.png"/></div>
		<div class="template" data-template="textpict-right"><img src="img/templates/textpict-right.png"/></div>
		<div class="template" data-template="textpict-left"><img src="img/templates/textpict-left-large.png"/></div>
		<div class="template" data-template="textpict-right"><img src="img/templates/textpict-right-large.png"/></div>
		
		<div class="template" data-template="textpict-left"><img src="img/templates/texteye-left.png"/></div>
		<div class="template" data-template="textpict-right"><img src="img/templates/texteye-right.png"/></div>
		<div class="template" data-template="textpict-left"><img src="img/templates/texteye-left-large.png"/></div>
		<div class="template" data-template="textpict-right"><img src="img/templates/texteye-right-large.png"/></div>
		
		<div class="template" data-template="pict"><img src="img/templates/pict.png"/></div>
		<div class="template" data-template="pict-3cols"><img src="img/templates/pict-3cols.png"/></div>
		
		<div class="template" data-template="table-striped"><img src="img/templates/table-striped.png"/></div>
		<div class="template" data-template="table-striped-hard"><img src="img/templates/table-striped-hard.png"/></div>
		
		<div class="template" data-template="accordion"><img src="img/templates/accordion.png"/></div>	
		
		<div class="template" data-template="tab"><img src="img/templates/tab.png"/></div>	
		
		<div class="template" data-template="slider"><img src="img/templates/slider.png"/></div>	
	  </div>
	</div> 
 </body>